# 数据库显示与选择优化方案 (v2.1)

## 1. 需求分析

根据 `数据库显示.md` 的要求，当前问题如下：
1. **显示不直观**：卡片目前主要显示文件名（如 `test_ref.fa`），用户难以快速识别数据库内容。
2. **缺乏批量选择**：无法快速选择同一物种下某一特定类型（如所有 Genome）的数据库。

**目标**：
- 以 `sequence_type` 作为分组依据，`genome_version` 作为卡片主标题。
- 提供按类型批量选择/取消的功能。

---

## 2. 方案设计

### 2.1 数据层级重构

将右侧数据库列表从**平铺布局**改为**按 `sequence_type` 分组的两级布局**。

**当前布局 (扁平)：**
```
┌─────────────────────────────────┐
│ [Card] test_ref.fa              │ ← 文件名为主
│        IRGSP-1.0 | genome       │
├─────────────────────────────────┤
│ [Card] test.cds.fa              │
│        IRGSP-1.0 | cds          │
└─────────────────────────────────┘
```

**优化后布局 (分组)：**
```
┌─────────────────────────────────────────────┐
│ ▼ 基因组 (Genome)             [全选] [取消] │ ← 分组标题
├─────────────────────────────────────────────┤
│  [Card] IRGSP-1.0                           │ ← genome_version 为主
│         test_ref.fa                         │ ← 文件名为辅
│  [Card] T2T-NIP                             │
│         oryza_sativa_T2T-NIP.t2t.test.fa    │
├─────────────────────────────────────────────┤
│ ▼ CDS                         [全选] [取消] │
├─────────────────────────────────────────────┤
│  [Card] IRGSP-1.0                           │
│         test.cds.fa                         │
└─────────────────────────────────────────────┘
```

### 2.2 UI 细节

| 元素 | 当前 | 优化后 |
|------|------|--------|
| 分组标题 | 无 | `sequence_type` 的本地化名称（见下方映射表） |
| 卡片主标题 | `db.name` (文件名) | `db.genome_version`（若空则回退到文件名） |
| 卡片副标题 | `genome_version` + `sequence_type` 徽章 | 仅文件名 `db.name`（小字灰色） |
| 批量操作 | 仅"全选当前物种" | 新增"按类型全选/取消" |

**本地化映射表 (typeLabelMap)**：
| `sequence_type` | 显示名称 |
|-----------------|----------|
| `genome`        | 基因组   |
| `cds`           | CDS      |
| `exon`          | 外显子   |
| 其他/未知       | 原值大写 |

### 2.3 边界情况处理

1. **`genome_version` 为空**：卡片主标题回退显示文件名。
2. **同类型+同版本存在多个数据库**：由于文件名作为副标题始终显示，用户可区分。
3. **物种下只有一种类型**：仍显示分组标题，保持布局一致性。
4. **分组排序**：按预定义顺序排列（Genome > CDS > Exon > 其他按字母排序）。

### 2.4 交互逻辑

- **点击分组标题旁的"全选"**：将该类型下所有数据库的 `id` 加入 `modelValue`。
- **点击"取消"**：从 `modelValue` 中移除该类型下所有数据库的 `id`。
- **左侧物种统计**：保持不变，显示该物种下已选/总数。
- **右侧分组标题统计（可选增强）**：显示"已选 X / 共 Y"。

---

## 3. 任务列表

### Phase 1: Logic Refactoring
- [x] **Task 1.1**: 创建 `typeLabelMap` 常量，定义 sequence_type 的本地化映射（含预定义排序权重）。
- [x] **Task 1.2**: 新增 `databasesByType` computed 属性，将 `currentDatabases` 按 `sequence_type` 分组并排序。
- [x] **Task 1.3**: 实现 `selectAllByType(type: string)` 和 `deselectAllByType(type: string)` 方法。

### Phase 2: UI Implementation
- [x] **Task 2.1**: 重构右侧模板，外层遍历 `databasesByType`，渲染分组 Header（含本地化标题 + 批量按钮）。
- [x] **Task 2.2**: 调整卡片内容，主标题改为 `genome_version`（或文件名），副标题显示文件名。
- [x] **Task 2.3**: 移除卡片内的 `sequence_type` 徽章。
- [x] **Task 2.4**: 调整右侧 Header 区域的"共 X 个基因组数据库"文案为"共 X 个数据库"。

### Phase 3: Verification
- [x] **Test 3.1**: 测试包含多种类型（Genome + CDS）的物种，验证分组显示正确。
- [x] **Test 3.2**: 测试类型全选/反选功能，验证选中状态同步到左侧统计。
- [x] **Test 3.3**: 测试 `genome_version` 为空的数据库，验证回退逻辑。
- [x] **Test 3.4**: 测试左侧物种列表的徽章统计是否仍正确。

---

## 4. 风险与依赖

| 风险 | 缓解措施 |
|------|----------|
| 分组后单组数据过多，滚动体验差 | 可考虑折叠/展开功能（本期不做） |
| 新数据类型未在 `typeLabelMap` 中 | 使用原始值并首字母大写 |
